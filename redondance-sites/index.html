<!DOCTYPE html><html lang="fr"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="theme-color" content="#3F80FF"/><meta data-react-helmet="true" name="google-site-verification" content="18MIKg3LXM5E_B-fq-2nGUfIsFItgDJlbt6lMVSGtUw"/><meta data-react-helmet="true" name="twitter:image" content="https://blog.beerus.fr/static/6653c9ced1b648aa5680b8eebf01fe3f/thumbnail.svg"/><meta data-react-helmet="true" name="twitter:description" content="Contexte Mon serveur hébergé a des petits soucis en ce moment, il a tendance à planter régulièrement malgré le fait que je le supervise…"/><meta data-react-helmet="true" name="twitter:title" content="Redondance &quot;du pauvre&quot; d&#x27;un site personnel"/><meta data-react-helmet="true" name="twitter:creator" content=""/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" property="og:image" content="https://blog.beerus.fr/static/6653c9ced1b648aa5680b8eebf01fe3f/thumbnail.svg"/><meta data-react-helmet="true" property="og:description" content="Contexte Mon serveur hébergé a des petits soucis en ce moment, il a tendance à planter régulièrement malgré le fait que je le supervise…"/><meta data-react-helmet="true" property="og:title" content="Redondance &quot;du pauvre&quot; d&#x27;un site personnel"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:url" content="https://blog.beerus.fr/redondance-sites"/><meta data-react-helmet="true" name="image" content="https://blog.beerus.fr/static/6653c9ced1b648aa5680b8eebf01fe3f/thumbnail.svg"/><meta data-react-helmet="true" name="description" content="Contexte Mon serveur hébergé a des petits soucis en ce moment, il a tendance à planter régulièrement malgré le fait que je le supervise…"/><meta name="generator" content="Gatsby 4.14.0"/><style data-href="/styles.a6f6fde9679e5026779c.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:400;src:url(/static/roboto-400-465390c6e54c60f4a15ff698f372e858.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:500;src:url(/static/roboto-500-324b1e6d0f5ae7c6ab42fed5516c7b3d.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Roboto;font-style:normal;font-weight:700;src:url(/static/roboto-700-18034c13b329fd74d51af5c9e2ddee1e.woff2) format("woff2");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-display:swap;font-family:Roboto Mono;font-style:normal;font-weight:400;src:url(/static/roboto-mono-400-336c829bcd5d167e6d7942a2bd64c703.woff) format("woff");unicode-range:U+00??,U+0131,U+0152-0153,U+02bb-02bc,U+02c6,U+02da,U+02dc,U+2000-206f,U+2074,U+20ac,U+2122,U+2191,U+2193,U+2212,U+2215,U+feff,U+fffd}@font-face{font-family:PerfectDOS;src:url(/static/PerfectDos-4df1d5bd795358c80faab26511d48071.ttf) format("truetype")}*,:after,:before,html{-webkit-box-sizing:border-box;box-sizing:border-box}body,figure{margin:0}html{font:normal normal normal 1rem/1.6 Helvetica Neue,Roboto,-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-family:Helvetica Neue,Roboto,-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-size:84%!important}body{color:#454545;font-size:1rem;-webkit-transition:background .4s ease;transition:background .4s ease}@media(min-width:620px){body{font-size:1.15rem}}.gatsby-resp-iframe-wrapper,dl,ol,p,table,ul,video{font-size:1.25rem;margin:0 0 1.5rem}@media(min-width:620px){.gatsby-resp-iframe-wrapper,dl,ol,p,table,ul,video{font-size:1.35rem;margin:0 0 2rem}}ul li p{margin:0}ul li ul{margin:0;padding-left:1rem}ul li ul li{margin:.25rem 0}ol li ol{margin-bottom:0}h1,h2,h3,h4,h5{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#111;font-family:Roboto,-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-weight:500;line-height:1.3}h1,h1:not(:first-child),h2,h2:not(:first-child),h3,h3:not(:first-child),h4,h4:not(:first-child),h5,h5:not(:first-child){margin:0 0 1rem}h1{font-size:1.95rem;font-weight:500}h1 code{font-size:1.95rem!important}h2{font-size:1.8rem;font-weight:500;padding-bottom:.2rem}h2 code{font-size:1.8rem!important}h3{color:#444;font-size:1.6rem}h3,h4{font-weight:500}h4{color:#777;font-size:1.4rem}h5{font-size:1.3rem;font-weight:500}@media(min-width:620px){h1,h2,h3,h4,h5{margin:0 0 2rem}h1:not(:first-child),h2:not(:first-child),h3:not(:first-child),h4:not(:first-child),h5:not(:first-child){margin:0 0 1.5rem}h1{font-size:2.6rem}h1 code{font-size:2.6rem!important}h2{font-size:2.3rem}h2 code{font-size:2.3rem!important}h3{font-size:1.95rem}h4{font-size:1.6rem}h5{font-size:1.5rem}}ul{padding:0}ul li{list-style-type:none;margin-bottom:.3rem;margin-left:.5rem;padding-left:1.5rem;position:relative}ul li.task-list-item{margin-left:0;padding-left:0}ul li.task-list-item:before{content:""}ul li:before{color:#929292;content:"•";font-size:22px;left:0;line-height:1.1;position:absolute}@media(min-width:620px){ul li{margin-left:1.5rem;padding-left:1.5rem}}a{color:#5183f5;font-weight:500;text-decoration:none}a:active,a:focus,a:hover{color:#2161f2}.lead a:not(.button):not(.anchor):not(.gatsby-resp-image-link),.lead a:not(span.gatsby-resp-image-wrapper),.page a:not(.button):not(.anchor):not(.gatsby-resp-image-link),.page a:not(span.gatsby-resp-image-wrapper),.post a:not(.button):not(.anchor):not(.gatsby-resp-image-link),.post a:not(span.gatsby-resp-image-wrapper){border-radius:4px;padding:1px 2px}.lead a:not(.button):not(.anchor):not(.gatsby-resp-image-link):hover,.lead a:not(span.gatsby-resp-image-wrapper):hover,.page a:not(.button):not(.anchor):not(.gatsby-resp-image-link):hover,.page a:not(span.gatsby-resp-image-wrapper):hover,.post a:not(.button):not(.anchor):not(.gatsby-resp-image-link):hover,.post a:not(span.gatsby-resp-image-wrapper):hover{background:#2161f2;color:#f0f4fe}.lead a:not(.button):not(.anchor):not(.gatsby-resp-image-link):active,.lead a:not(.button):not(.anchor):not(.gatsby-resp-image-link):focus,.lead a:not(span.gatsby-resp-image-wrapper):active,.lead a:not(span.gatsby-resp-image-wrapper):focus,.page a:not(.button):not(.anchor):not(.gatsby-resp-image-link):active,.page a:not(.button):not(.anchor):not(.gatsby-resp-image-link):focus,.page a:not(span.gatsby-resp-image-wrapper):active,.page a:not(span.gatsby-resp-image-wrapper):focus,.post a:not(.button):not(.anchor):not(.gatsby-resp-image-link):active,.post a:not(.button):not(.anchor):not(.gatsby-resp-image-link):focus,.post a:not(span.gatsby-resp-image-wrapper):active,.post a:not(span.gatsby-resp-image-wrapper):focus{background:#0c49d4;color:#f0f4fe}.lead img,.page img,.post img{height:auto;max-width:100%}mark{background:#ffeea8;padding:0 .2rem}b,strong{font-weight:600}blockquote cite{display:block;text-align:right}hr{border:0;border-top:2px solid #ccc;height:0}dt{font-weight:500}dd{margin-bottom:.5rem}[type=checkbox]{margin-right:1rem}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.vertical-center{-ms-flex-align:center;-ms-flex-pack:center;align-items:center;justify-content:center}.flex,.vertical-center{display:-ms-flexbox;display:flex}.show{display:block!important}.hide{display:none!important}.invisible{visibility:hidden}.green{color:#1fc844}.pink{color:#ff5a5f}.blue{color:#5183f5}.yellow{color:#fec623}.crypto p{margin-bottom:.5rem}.screen-reader-text{clip:rect(1px,1px,1px,1px);height:1px;overflow:hidden;position:absolute!important;width:1px}.button,[type=button],[type=submit],a.button,button{-webkit-appearance:none;background:#5183f5;border:2px solid #5183f5;border-radius:6px;color:#fff;cursor:pointer;display:inline-block;font-family:Helvetica Neue,Roboto,-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-size:1.1rem;font-weight:500;line-height:1;margin:0 0 .5rem;padding:.6rem .9rem;text-align:center;text-decoration:none;text-transform:none;vertical-align:middle}.button:active,.button:focus,.button:hover,[type=button]:active,[type=button]:focus,[type=button]:hover,[type=submit]:active,[type=submit]:focus,[type=submit]:hover,button:active,button:focus,button:hover{background:#0e51ec;border:2px solid #0e51ec;color:#fff;text-decoration:none}.button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=submit]::-moz-focus-inner,a.button::-moz-focus-inner,button::-moz-focus-inner{border:0;padding:0}.button:disabled,[type=button]:disabled,[type=submit]:disabled,a.button:disabled,button:disabled{cursor:default;pointer-events:none}.button:active,[type=button]:active,[type=submit]:active,a.button:active,button:active{-webkit-transform:scale(.95);transform:scale(.95)}.button.muted-button,a.button.muted-bottom{background:#e5e5e5;border:2px solid #e5e5e5;color:#454545}.button.muted-button:active,.button.muted-button:focus,.button.muted-button:hover,a.button.muted-bottom:active,a.button.muted-bottom:focus,a.button.muted-bottom:hover{background:#d9d9d9;border:2px solid #d9d9d9;color:#111}.twitter-button,a.twitter-button{background:#00aced;border:2px solid #00aced}.twitter-button:active,.twitter-button:focus,.twitter-button:hover,a.twitter-button:active,a.twitter-button:focus,a.twitter-button:hover{background:#0099d4;border:2px solid #0099d4;color:#fff}@media(min-width:620px){.button,[type=button],[type=submit],a.button,button{padding:.75rem 1.25rem}}[type=color],[type=date],[type=email],[type=number],[type=search],[type=text],[type=url],select,textarea{border:2px solid #ccc;border-radius:6px;display:block;font-size:1.1rem;font-weight:500;line-height:1;margin-bottom:.5rem;max-width:100%;outline:none;padding:.75rem;width:100%}[type=color]:hover,[type=date]:hover,[type=email]:hover,[type=number]:hover,[type=search]:hover,[type=text]:hover,[type=url]:hover,select:hover,textarea:hover{background:#f7f7f7;border:2px solid #b3b3b3}[type=color]:active,[type=color]:focus,[type=date]:active,[type=date]:focus,[type=email]:active,[type=email]:focus,[type=number]:active,[type=number]:focus,[type=search]:active,[type=search]:focus,[type=text]:active,[type=text]:focus,[type=url]:active,[type=url]:focus,select:active,select:focus,textarea:active,textarea:focus{background:#f0f4fe;border:2px solid #5183f5}textarea{height:auto;line-height:1.6;overflow:auto}fieldset{border:2px solid #ccc;border-radius:6px;margin:2rem 0;padding:60px}legend{font-weight:500;padding:0 .5rem}select{-webkit-appearance:none;-moz-appearance:none;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAJCAYAAAA/33wPAAAAvklEQVQoFY2QMQqEMBBFv7ERa/EMXkGw11K8QbDXzuN4BHv7QO6ifUgj7v4UAdlVM8Uwf+b9YZJISnlqrfEUZVlinucnBGKaJgghbiHOyLyFKIoCbdvecpyReYvo/Ma2bajrGtbaC58kCdZ1RZ7nl/4/4d5EsO/7nzl7IUtodBexMMagaRrs+06JLMvcNWmaOv2W/C/TMAyD58dxROgSmvxFFMdxoOs6lliWBXEcuzokXRbRoJRyvqqqQvye+QDMDz1D6yuj9wAAAABJRU5ErkJggg==) 100% no-repeat;color:#454545;line-height:1}select::-ms-expand{display:none}[type=range]{width:100%}label{display:block;font-size:1rem;font-weight:700;margin:1rem 0 .5rem;max-width:100%}:-moz-placeholder,:-ms-input-placeholder,::-moz-placeholder,::-webkit-input-placeholder{color:#9a9a9a}table{border-collapse:collapse;border-spacing:0;display:block;max-width:100%;overflow-x:auto;white-space:nowrap;width:100%}th{border-bottom:2px solid #ccc}tfoot th{border-top:1px solid #ccc}td{border-bottom:1px solid #ccc}td,th{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;padding:.75rem!important;text-align:left;width:100%;word-break:break-word}caption{caption-side:bottom;color:#ababab;padding:60px 0}tbody tr:nth-child(2n){background-color:#f8f8f8}.nav{background:#fff;left:0;position:fixed;top:0;-webkit-transition:background .4s ease;transition:background .4s ease;width:100%;z-index:3}.nav.scroll{-webkit-box-shadow:1px 2px 18px rgba(0,0,0,.1);box-shadow:1px 2px 18px rgba(0,0,0,.1)}.nav.scroll .nav-container{padding:0 1.5rem}.nav .cta{margin:0 0 0 .75rem}.nav .cta,.nav .nav-container{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}.nav .nav-container{-ms-flex-pack:justify;height:55px;justify-content:space-between;margin:auto;max-width:800px;padding:1.5rem 1.5rem 0;-webkit-transition:height .4s ease;transition:height .4s ease}.nav .nav-container .nav-icon-hide-mobile{display:none}.nav .brand a{-ms-flex-align:center;align-items:center;color:#333;display:-ms-flexbox;display:flex;font-size:1.15rem;font-weight:500;margin-right:0}.nav .brand a:focus,.nav .brand a:hover{color:#000}.nav .links{-ms-flex-pack:end;-ms-flex-align:center;-ms-flex:1 1;flex:1 1;-ms-flex-direction:row;flex-direction:row;justify-content:flex-end;margin:0}.nav .links,.nav .links a{align-items:center;display:-ms-flexbox;display:flex}.nav .links a{-ms-flex-align:center;border-radius:6px;color:rgba(0,0,0,.6);font-size:1.05rem;font-weight:400;line-height:1.2;margin:.25rem;padding:.75rem;text-align:center}.nav .links a.active,.nav .links a:active,.nav .links a:hover{background:rgba(0,0,0,.05);color:#111}.favicon{border-radius:50%;height:40px;margin-bottom:0;margin-right:1rem;min-width:40px;width:40px}button.dark-switcher{-webkit-appearance:none;background:transparent;border:0;margin:0;padding:.75rem .5rem}button.dark-switcher:focus{outline:none}.nav-icons{height:1.3rem;margin-bottom:0;min-width:1.3rem;width:1.3rem}.github-nav-icon{color:#000}.camera-nav-icon{color:#bd0000}.twitter-nav-icon{color:#1da1f2}.sun-nav-icon{color:#fcc21b}.moon-nav-icon{color:#7890ff}@media(min-width:620px){.nav.scroll .nav-container{height:60px}.nav.scroll .favicon{height:40px;min-width:40px;width:40px}.nav .nav-container{height:160px;padding:0 2rem}.nav .nav-container .nav-icon-hide-mobile{display:-ms-flexbox;display:flex}.nav .brand a{font-size:1.3rem}.nav .brand .text{display:block}.nav .links{-ms-flex-pack:end;display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;height:100%;justify-content:flex-end}.nav .links a{border-bottom:2px solid transparent;font-size:1.2rem;margin:0 .5rem;padding:1rem}.nav .favicon{height:70px;margin-right:1rem;min-width:70px;width:70px}.nav button.dark-switcher{font-size:1.4rem;margin:0;padding:.75rem 1rem}.nav .nav-icons{height:1.65rem;margin-bottom:0;min-width:1.65rem;width:1.65rem}}@media print and (min-width:620px){.nav{display:none}}#main-content{margin-top:55px;min-height:calc(100vh - 190px);padding:40px 0 0}@media(min-width:620px){#main-content{margin-top:140px;min-height:calc(100vh - 360px)}}.container{margin-left:auto;margin-right:auto;max-width:800px;padding:0 1.5rem}@media(min-width:620px){.container{padding:0 2rem}}.lead{font-size:1.1rem;margin:0 auto}.lead h1{font-size:3.2rem;font-weight:600;margin-bottom:1.5rem;margin-top:0}.lead p{color:rgba(0,0,0,.6);font-size:1.6rem}.lead .button{margin-right:.5rem}@media screen and (min-width:750px){.lead{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;font-size:1.2rem;line-height:1.5}.lead .elevator{-ms-flex:2 1;flex:2 1;margin-left:2rem}.lead h1{font-size:4rem}.lead p{font-size:1.65rem}.lead .button{margin-right:.5rem}}.callouts{display:none}@media(min-width:620px){.callouts{display:block}a.article-callout{-ms-flex-align:center;align-items:center;border:none!important;border-radius:4px;-webkit-box-shadow:1px 2px 10px rgba(0,0,0,.1);box-shadow:1px 2px 10px rgba(0,0,0,.1);color:#454545;display:-ms-flexbox;display:flex;font-size:1.5rem;font-weight:500;margin:1.5rem 0;padding:1.5rem;-webkit-transition:all .3s ease;transition:all .3s ease}a.article-callout:active,a.article-callout:focus,a.article-callout:hover{background:#fff;-webkit-box-shadow:3px 5px 20px rgba(0,0,0,.16);box-shadow:3px 5px 20px rgba(0,0,0,.16);color:#111}a.article-callout img{height:50px;margin:0 1.5rem 0 0;max-width:50px;width:50px}}.front-page{margin-top:2rem;padding:0 2rem}.front-page h2{-ms-flex-align:center;-ms-flex-pack:justify;align-items:center;border-bottom:0;display:-ms-flexbox;display:flex;justify-content:space-between;padding-bottom:0}@media(min-width:620px){.front-page h2{-ms-flex-pack:start;justify-content:flex-start}}.single .gatsby-image-wrapper{height:50px!important;width:50px!important}@media(min-width:620px){.single .gatsby-image-wrapper{-ms-flex-order:1;height:150px!important;margin-left:2rem;order:1;width:150px!important}.front-page{padding:0 4rem}}.single-header{display:grid;margin-bottom:30px}.single-header .flex,.single-header.no-thumbnail{display:-ms-flexbox;display:flex}.single-header .flex{-ms-flex-direction:column;flex-direction:column}.single-header h1{font-weight:600;margin:.5rem 0}.single-header .post-meta{margin-bottom:1rem}@media(min-width:620px){.single-header{display:grid;grid-template-columns:1fr 180px;margin-bottom:60px}.single-header h1{margin:0 0 .5rem}}.post-container{display:-ms-flexbox;display:flex}.posts a{display:block}.posts a .each{border:1px solid transparent;border-bottom-color:#ebebeb;display:grid;grid-template-columns:50px 1fr 0;margin:0;padding:1rem 0}.posts a .each .date{color:rgba(0,0,0,.4);font-size:.9rem;font-weight:400;margin:0}.posts a:last-of-type .each{border-bottom-color:transparent}.posts h2{border-bottom:none;font-size:1.25rem;font-weight:500;line-height:2rem;margin:0;padding:0}.posts .gatsby-image-wrapper{height:30px!important;margin-top:0;width:30px!important}.posts.simple a .each{-ms-flex-align:center;align-items:center;border:1px solid transparent;grid-template-columns:50px 2fr auto;margin:0;padding:.5rem 0}.posts.simple a .each:hover{background:#fff}.posts.simple a:last-of-type .each{border-bottom:1px solid transparent!important}.posts.simple .gatsby-image-wrapper{height:30px!important;margin-top:0;width:30px!important}.posts.simple h2{color:#454545;font-size:1.2rem;font-weight:500;margin:0;padding:0}.posts.simple h2:hover{color:#111}.posts .datetime{display:block}.posts .datetime,.posts .excerpt{color:rgba(0,0,0,.6);font-size:1.1rem;font-weight:400}.posts .excerpt{margin-top:1rem}@media(min-width:620px){.posts a .each{-ms-flex-align:start;align-items:start;grid-template-columns:80px 1fr;margin:0 -2rem;padding:2rem}.posts a .each:hover{background:#fafafa;border-radius:6px}.posts a .each:hover h2{color:#111}.posts a .each:active,.posts a .each:focus{background:#f0f4fe;border:1px dashed #5183f5}.posts a .each h2{font-size:1.35rem;line-height:2rem;margin:0 0 .25rem}.posts a .each .gatsby-image-wrapper{height:50px!important;margin-top:0;width:50px!important}.posts.simple a .each{border-bottom:1px solid #ebebeb;margin:0 -1rem;padding:.75rem 1rem}.posts.simple a .each:hover{background:#f2f2f2;border:1px solid #f2f2f2}.posts.simple a .each:active,.posts.simple a .each:focus{background:#f0f4fe;border:1px dashed #5183f5}.posts.simple a .each h2{font-size:1.3rem;margin:0}.posts.simple a .each .gatsby-image-wrapper{height:30px!important;width:30px!important}}.page h2,.post h2{border-bottom:1px solid #ebebeb}.tag-container a,.tag-container span{display:inline-block}.tag-container span{background:#f2f2f2;border-radius:6px;color:#5f5f5f;font-size:1rem;font-weight:400;margin:0 .5rem .5rem 0;padding:.3rem .5rem}.tag-container span .count{color:#5183f5;font-weight:700;margin-left:.25rem}.tag-container span:active,.tag-container span:focus,.tag-container span:hover{background:#e5e5e5;color:#454545}.tag-container.articles-page-tags{margin-bottom:1rem}@media(min-width:620px){.tag-container span{font-size:1rem;font-weight:500;padding:.3rem .8rem}.tag-container span .count{margin-left:.5rem}.tag-container.articles-page-tags{display:-ms-flexbox;display:flex;margin-bottom:2rem}.tag-container.articles-page-tags a{-ms-flex:1 1;flex:1 1}.tag-container.articles-page-tags a span{-ms-flex-pack:center;display:-ms-flexbox;display:flex;justify-content:center}}.post-meta{-ms-flex-align:center;align-items:center;color:rgba(0,0,0,.6);display:-ms-inline-flexbox;display:inline-flex;font-size:1.3rem}.post-meta .date{margin-right:.5rem}.post-meta a.comment-link,.post-meta a.github-link,.post-meta a.twitter-link{margin:0 .5rem}@media(min-width:620px){.post-meta{font-size:1.4rem}}blockquote{background:#fff4d5;border:2px solid #ffedbb;border-radius:6px;color:rgba(0,0,0,.8);font-size:1rem;font-weight:500;line-height:1.6;margin:1.5rem 0;padding:1.5rem}blockquote p{font-size:1.15rem;padding:0}blockquote p:last-child{margin-bottom:0}blockquote a{border-bottom:none!important;color:#111}blockquote a:active,blockquote a:focus,blockquote a:hover{background:#ffebb1!important;color:#111!important}blockquote code{margin:1rem 0 0}blockquote ul:last-of-type{margin-bottom:0}@media(min-width:620px){blockquote{padding:2rem}blockquote p{font-size:1.5rem}blockquote cite{font-size:2rem}}.search{margin-bottom:0}.filter-count{color:#2161f2;font-size:1.4rem;font-weight:500;text-align:center;width:80px}.emoji-in-button{font-size:1.5rem;line-height:0;margin-left:.75rem}.search-container{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;margin-bottom:2rem}.category-container{-ms-flex-pack:start;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;justify-content:flex-start;margin-bottom:1.5rem}.category-container .category-filter{-ms-flex-align:center;align-items:center;background:#ebf1fe;border-radius:6px;color:#2161f2;cursor:pointer;display:-ms-flexbox;display:flex;font-size:.85rem;font-weight:500;margin-bottom:.5rem;margin-right:.5rem;padding:.5rem .75rem}.category-container .category-filter .count{-ms-flex-align:center;-ms-flex-pack:center;align-items:center;border-radius:50%;color:#5183f5;display:-ms-flexbox;display:flex;font-size:.8rem;height:23px;justify-content:center;margin-left:1rem;padding:5px;width:23px}.category-container .category-filter.active{background:#5183f5;color:#fff}.category-container .category-filter.active .count{background:#fff}.category-container .category-filter.active:active,.category-container .category-filter.active:focus,.category-container .category-filter.active:hover{background:#2161f2;color:#fff}.category-container .category-filter:last-of-type{margin-right:0}.category-container .category-filter:hover{background:#d8e3fd;color:#3972f4}@media(min-width:620px){.category-container{margin-bottom:1.5rem}.category-container .category-filter{font-size:1rem;padding:.5rem 1rem}}.footer{-ms-flex-pack:justify;color:rgba(0,0,0,.6);-ms-flex-direction:column;flex-direction:column;justify-content:space-between;margin-top:2.5rem}.footer,.footer div{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}.footer div{padding-bottom:1.5rem}.footer strong{margin-right:1rem}.footer a{color:rgba(0,0,0,.6);display:block;font-weight:400;margin-right:1.5rem}.footer a:hover{color:rgba(0,0,0,.8)}.footer .footer-img{height:30px;margin-bottom:0;width:30px}@media(min-width:620px){.footer{-ms-flex-direction:row;flex-direction:row;height:100px;margin:60px auto}}iframe{margin-bottom:0}[type=submit]:disabled,[type=submit]:disabled:active,[type=submit]:disabled:focus,[type=submit]:disabled:hover,button[disabled],button[disabled]:active,button[disabled]:focus,button[disabled]:hover{opacity:.5}::-moz-selection{background:rgba(255,235,20,.7);color:#111}::selection{background:rgba(255,235,20,.7);color:#111}@media print{.footer{display:none}}code{font-size:13px}pre.language-shell-session code.language-shell-session{background:#fff;border:1px solid #d8d9da;border-radius:6px;-webkit-box-shadow:3px 5px 20px rgba(0,0,0,.16);box-shadow:3px 5px 20px rgba(0,0,0,.16);color:#333;font-family:Menlo,Roboto Mono,Courier New,monospace;font-size:13px;margin:2rem 0;padding:45px 1rem 1rem;position:relative}pre.language-shell-session code.language-shell-session:before{background:#e1e1e1;color:#c2c3c4;content:"•••";font-size:2.5rem;height:25px;left:0;letter-spacing:-15px;line-height:0;margin:0;padding:14px 0;position:absolute;text-indent:4px;top:0;width:100%}code[class*=language-],pre code,pre[class*=language-]{-webkit-font-smoothing:subpixel-antialiased;border-radius:6px;color:#b3b9c5;direction:ltr;font-family:Menlo,Roboto Mono,Courier New,monospace;font-size:13px;font-weight:400;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.7;margin:2rem 0;-moz-tab-size:2;-o-tab-size:2;tab-size:2;text-align:left;white-space:pre-wrap;word-break:normal;word-spacing:normal}pre code{background-color:#333;border:0;-webkit-box-shadow:2px 4px 25px rgba(0,0,0,.15);box-shadow:2px 4px 25px rgba(0,0,0,.15);display:block;overflow:auto;padding:1.5rem}kbd{background-color:#f7f7f7;border:2px solid rgba(0,0,0,.3);border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 2px #fff;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 2px #fff;color:#333;display:inline-block;font-family:Helvetica Neue,Roboto,-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif;font-size:14px;line-height:1.4;margin:0 .1em;padding:.1em .6em;text-shadow:0 1px 0 #fff}:not(pre)>code,:not(pre)>code[class*=language-]{color:#111;font-weight:500;padding:3px 5px}:not(pre)>code{background:rgba(0,0,0,.06);border:none;border-radius:4px;font-family:Menlo,Roboto Mono,Courier New,monospace}code[class*=language-css],code[class*=language-less],code[class*=language-sass],code[class*=language-scss]{color:#c9c}.filename{background:#111;border-top-left-radius:6px;border-top-right-radius:6px;color:#fff;font-size:1rem;font-weight:700;margin-bottom:-2.3rem;padding:.5rem 1rem .75rem}@media(min-width:620px){code,code[class*=language-],pre code,pre.language-shell-session code.language-shell-session,pre[class*=language-]{font-size:14px}}.token.doctype{background:#000;color:#fff}.token.cdata,.token.comment,.token.prolog{color:#848991}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#92d192}.token.punctuation{color:#d5d8df}.token.operator{color:#ac8d58}.token.variable{color:#f2777a}.token.property{color:#abb2bf}.token.builtin{color:#4a7baa}.token.parameter{color:#848991}.token.boolean,.token.constant{color:#e1a6f2}.token.entity,.token.inserted,.token.number,.token.regex,.token.symbol,.token.url{color:#fca369}.token.delimiter{background:#000;color:#fff;padding:1px 2px}.token.atrule{color:#62cfcf}.token.keyword{color:#ffeead}.language-autohotkey .token.selector{color:#fca369}.token.attr-name{color:#ffd479}.token.function{color:#62cfcf}.language-php .token.function{color:#fff}.token.class-name{color:#e1a6f2}.language-autohotkey .token.tag,.token.deleted{color:#f2777a}.token.tag{color:#6ab0f3}.language-autohotkey .token.keyword{color:#ffeead}.token.selector{color:#ffd479}.token.italic{font-style:italic}pre[data-line]{padding:1rem 0;position:relative}.line-highlight{background:hsla(0,0%,59%,.1);left:0;line-height:inherit;margin-top:1rem;padding-bottom:inherit;padding-left:0;padding-right:0;padding-top:inherit;pointer-events:none;position:absolute;right:0;white-space:pre}.line-highlight:before,.line-highlight[data-end]:after{background-color:transparent;border-radius:999px;color:transparent;content:attr(data-start);font:700 65%/1.5 sans-serif;left:.6em;min-width:1em;padding:0 .5em;position:absolute;text-align:center;text-shadow:none;top:.4em;vertical-align:.3em}.line-highlight[data-end]:after{bottom:.4em;content:attr(data-end);top:auto}.line-numbers .line-highlight:after,.line-numbers .line-highlight:before{content:none}code::-moz-selection,pre::-moz-selection{background:hsla(0,0%,59%,.3)!important;color:inherit;text-shadow:none}code::selection,pre::selection{background:hsla(0,0%,59%,.3)!important;color:inherit;text-shadow:none}code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:hsla(0,0%,59%,.3)!important;color:inherit;text-shadow:none}code[class*=language-] ::selection,pre[class*=language-]::selection{background:hsla(0,0%,59%,.3)!important;color:inherit;text-shadow:none}.gatsby-highlight-code-line{background-color:#191919;border-left:.25em solid #92d192;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:1em}.dark{background:#202020;color:#b3b9c5}.dark a{color:#6ab0f3}.dark a:active,.dark a:focus,.dark a:hover{background:transparent;color:#238aed}.dark .lead h1{color:#eee}.dark .lead a:not(.button):not(.anchor):not(.gatsby-resp-image-link){background:transparent!important;border-bottom:none}.dark .lead a:not(.button):not(.anchor):not(.gatsby-resp-image-link):hover{color:#238aed}.dark .page a:not(.button):not(.anchor):not(.gatsby-resp-image-link),.dark .page a:not(span.gatsby-resp-image-wrapper),.dark .post a:not(.button):not(.anchor):not(.gatsby-resp-image-link),.dark .post a:not(span.gatsby-resp-image-wrapper){border-bottom:2px solid transparent;padding:1px 2px}.dark .page a:not(.button):not(.anchor):not(.gatsby-resp-image-link):active,.dark .page a:not(.button):not(.anchor):not(.gatsby-resp-image-link):focus,.dark .page a:not(.button):not(.anchor):not(.gatsby-resp-image-link):hover,.dark .page a:not(span.gatsby-resp-image-wrapper):active,.dark .page a:not(span.gatsby-resp-image-wrapper):focus,.dark .page a:not(span.gatsby-resp-image-wrapper):hover,.dark .post a:not(.button):not(.anchor):not(.gatsby-resp-image-link):active,.dark .post a:not(.button):not(.anchor):not(.gatsby-resp-image-link):focus,.dark .post a:not(.button):not(.anchor):not(.gatsby-resp-image-link):hover,.dark .post a:not(span.gatsby-resp-image-wrapper):active,.dark .post a:not(span.gatsby-resp-image-wrapper):focus,.dark .post a:not(span.gatsby-resp-image-wrapper):hover{background:#3b97ef;border-radius:4px;color:#fff}.dark .page img,.dark .post img{height:auto;max-width:100%}.dark .page h2,.dark .post h2{border:none;color:#ffd479}.dark :not(pre)>code{background:hsla(0,0%,100%,.1);color:#b3b9c5}.dark .nav{background:#202020;border-color:#202020}.dark .nav.scroll{background:#131313;border-color:#131313}.dark .nav .brand a{color:#c1c6d0}.dark .nav .brand a:hover{color:#eee}.dark .nav .links a{color:#8891a4}.dark .nav .links a.active,.dark .nav .links a:hover{background:rgba(0,0,0,.2)}.dark .nav .links a:hover{color:#b3b9c5}.dark .nav .links a.active{color:#6ab0f3}.dark li,.dark ol,.dark p,.dark ul{color:#b3b9c5}.dark h2{border-color:#303030}.dark h1,.dark h2,.dark h3,.dark h4,.dark h5{color:#eee}.dark .posts.simple a .each{border-color:transparent transparent #181818}.dark .posts.simple a .each h2{color:#9fa3a9}.dark .posts.simple a .each:hover{background:#303030}.dark .posts a .each{border:1px solid transparent;border-bottom-color:#181818}.dark .posts a .each h2{color:#ccc}.dark .posts a .each:hover{background:#303030!important;border-color:#303030}.dark .posts a .each:hover h2{color:#fff}.dark .posts a .datetime{color:#848991}.dark .posts a .excerpt{color:hsla(0,0%,100%,.3)}.dark .tag-container span{background:rgba(0,0,0,.2);border:none;color:#b3b9c5}.dark .tag-container span .count{color:#ff5a5f}.dark .tag-container span:active,.dark .tag-container span:focus,.dark .tag-container span:hover{background:#111;border:none;color:#fff}.dark .post-meta{color:#848991}.dark th{border-bottom:2px solid #131313}.dark tfoot th{border-top:2px solid #0c0c0c}.dark td{border-bottom:2px solid #0c0c0c}.dark tbody tr:nth-child(2n){background-color:#2d2d2d}.dark pre code{background:#3a3a3a}.dark blockquote{background:rgba(0,0,0,.2);border:2px solid #393939}.dark blockquote p{color:#fed356}.dark blockquote a{border-bottom:#fed356!important;color:#fff4d5!important}.dark blockquote a:hover{background:#111!important;color:#febf0a!important}.dark blockquote.quotation{background:rgba(0,0,0,.2);border-color:#3a3a3a;-webkit-box-shadow:none;box-shadow:none;color:#fed356}.dark blockquote.quotation cite{color:#fff}.dark cite{color:hsla(0,0%,100%,.4)}.dark .footer,.dark .footer strong{color:#b3b9c5}.dark .footer a{color:#8891a4}.dark .footer a:hover{color:#d0d4db}.dark [type=color],.dark [type=date],.dark [type=email],.dark [type=number],.dark [type=search],.dark [type=text],.dark [type=url],.dark select,.dark textarea{background:#333!important;border:2px solid #444;color:#b3b9c5}.dark [type=color]:hover,.dark [type=date]:hover,.dark [type=email]:hover,.dark [type=number]:hover,.dark [type=search]:hover,.dark [type=text]:hover,.dark [type=url]:hover,.dark select:hover,.dark textarea:hover{border:2px solid #505050}.dark [type=color]:active,.dark [type=color]:focus,.dark [type=date]:active,.dark [type=date]:focus,.dark [type=email]:active,.dark [type=email]:focus,.dark [type=number]:active,.dark [type=number]:focus,.dark [type=search]:active,.dark [type=search]:focus,.dark [type=text]:active,.dark [type=text]:focus,.dark [type=url]:active,.dark [type=url]:focus,.dark select:active,.dark select:focus,.dark textarea:active,.dark textarea:focus{border:2px solid #6ab0f3}.dark .button,.dark [type=button],.dark [type=submit],.dark a.button,.dark button{background:#0f64b5!important;border:2px solid transparent;color:#fff}.dark .button:disabled,.dark [type=button]:disabled,.dark [type=submit]:disabled,.dark a.button:disabled,.dark button:disabled{cursor:default;opacity:.3;pointer-events:none}.dark .button:active,.dark .button:focus,.dark .button:hover,.dark [type=button]:active,.dark [type=button]:focus,.dark [type=button]:hover,.dark [type=submit]:active,.dark [type=submit]:focus,.dark [type=submit]:hover,.dark a.button:active,.dark a.button:focus,.dark a.button:hover,.dark button:active,.dark button:focus,.dark button:hover{background:#127ee5!important;border:2px solid transparent;color:#fff}.dark .new,.dark .popular{background:rgba(0,0,0,.2)}.dark .popular{color:#92d192}.dark .button.muted-button,.dark a.button.muted-bottom{border:2px solid #848991;color:#848991}.dark .button.muted-button:active,.dark .button.muted-button:focus,.dark .button.muted-button:hover,.dark a.button.muted-bottom:active,.dark a.button.muted-bottom:focus,.dark a.button.muted-bottom:hover{background:transparent;border:2px solid #b3b9c5;color:#b3b9c5}.dark button.dark-switcher{background:transparent!important;border:none!important}.dark pre.language-shell-session code.language-shell-session{background:#111;border:2px solid #666;color:#ccc}.dark pre.language-shell-session code.language-shell-session:before{background:#303030;color:#888}.dark .category-container .category-filter{background:rgba(0,0,0,.2);color:#6ab0f3;cursor:pointer;font-weight:500}.dark .category-container .category-filter.active{background:#6ab0f3!important;color:#fff!important}.dark .category-container .category-filter:last-of-type{margin-right:0}.dark .category-container .category-filter:hover{background:#111;color:#99c9f7}.dark .filter-count{color:#6ab0f3}.dark mark{background:#127ee5;color:#fff}.dark ::-moz-selection{background:#6ab0f3;color:#fff}.dark ::selection{background:#6ab0f3;color:#fff}.dark path{stroke:#ffeead}.dark .github-nav-icon{color:#fff}.not-found{background:#000084;color:#bbb;font-family:PerfectDOS,Courier New,monospace;font-size:16px;font-weight:400;height:100vh}.not-found #main-content{margin:0;padding-top:80px}.not-found button.dark-switcher,.not-found footer.footer{display:none}.not-found h1{background:#bbb;-webkit-box-shadow:10px 10px 0 #000;box-shadow:10px 10px 0 #000;color:#000;display:inline-block;font-family:PerfectDOS,Courier New,monospace;font-weight:600;margin-bottom:40px;padding:10px 20px}.not-found p{font-size:16px}.not-found .list p:not(:last-of-type){margin-bottom:5px}.not-found .bullet{margin-right:30px}.not-found .error-msg{color:#ff0}.not-found .nav{background:#bbb;border-bottom:2px solid #bbb;color:#000;height:30px}.not-found .nav .nav-container{height:30px;padding:0}.not-found .nav .nav-container .brand{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}.not-found .nav .nav-container .brand,.not-found .nav .nav-container .brand a,.not-found .nav .nav-container .links{height:30px}.not-found .nav .nav-container .brand a,.not-found .nav .nav-container .links a{border-radius:0;color:#000;font-size:16px;font-weight:600;line-height:30px;margin:0;padding:0 5px}.not-found .nav .nav-container .brand a:active,.not-found .nav .nav-container .brand a:focus,.not-found .nav .nav-container .brand a:hover,.not-found .nav .nav-container .links a:active,.not-found .nav .nav-container .links a:focus,.not-found .nav .nav-container .links a:hover{background:#000;color:#bbb}.not-found .nav .nav-container a.kofi-button{background:#0aa;border:none;border-radius:0;color:#eee;display:none;height:30px}.not-found .nav .nav-container a.kofi-button:active,.not-found .nav .nav-container a.kofi-button:focus,.not-found .nav .nav-container a.kofi-button:hover{background:#000;border:none;color:#fff}@media(min-width:900px){.not-found{font-size:24px}.not-found #main-content{padding-top:160px}.not-found .nav .nav-container .brand a,.not-found .nav .nav-container .links a{font-size:24px;padding:0 15px}.not-found p{font-size:24px}.not-found .emoji,.not-found img{display:none}}.blink{-webkit-animation:blinkingText .8s infinite;animation:blinkingText .8s infinite}@-webkit-keyframes blinkingText{0%{opacity:0}49%{opacity:0}50%{opacity:1}}@keyframes blinkingText{0%{opacity:0}49%{opacity:0}50%{opacity:1}}.twitter-tweet{margin-bottom:2rem!important;margin-top:0!important}</style><title data-react-helmet="true">Redondance &quot;du pauvre&quot; d&#x27;un site personnel – Beerus blog</title><link data-react-helmet="true" rel="icon" type="image/png" href="/static/favicon-256-f20245a369a5ff9292f43e7bc768bc62.png"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://blog.beerus.fr/","name":"Redondance \"du pauvre\" d'un site personnel","alternateName":"Beerus blog"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://blog.beerus.fr/redondance-sites","name":"Redondance \"du pauvre\" d'un site personnel","image":"https://blog.beerus.fr/static/6653c9ced1b648aa5680b8eebf01fe3f/thumbnail.svg"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://blog.beerus.fr/","name":"Redondance \"du pauvre\" d'un site personnel","alternateName":"Beerus blog","headline":"Redondance \"du pauvre\" d'un site personnel","image":{"@type":"ImageObject","url":"https://blog.beerus.fr/static/6653c9ced1b648aa5680b8eebf01fe3f/thumbnail.svg"},"description":"Contexte Mon serveur hébergé a des petits soucis en ce moment, il a tendance à planter régulièrement malgré le fait que je le supervise…"}]</script><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 100)
          }), 0)
        }
      }
    })
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/favicon/favicon-48.png"/><link rel="apple-touch-icon" sizes="1024x1024" href="/favicon/favicon-1024.png"/><link rel="alternate" type="application/rss+xml" title="Beerus Inc. - RSS Feed" href="/rss.xml"/></head><body class="theme dark"><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="nav"><div class="nav-container"><div class="brand"><a href="/"><img src="/static/avatar-8c427968a9e9b833cce13fc74e7b3f88.png" class="favicon" alt="Avatar"/><span class="text">Beerus Inc.</span></a></div><div class="links"><a href="https://github.com/ramuskay"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" class="nav-icons github-nav-icon" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://twitter.com/retyyuiop"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="nav-icons twitter-nav-icon" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Twitter</title><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://photos.beerus.fr"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="nav-icons camera-nav-icon" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title>Photos</title><path d="M512 144v288c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V144c0-26.5 21.5-48 48-48h88l12.3-32.9c7-18.7 24.9-31.1 44.9-31.1h125.5c20 0 37.9 12.4 44.9 31.1L376 96h88c26.5 0 48 21.5 48 48zM376 288c0-66.2-53.8-120-120-120s-120 53.8-120 120 53.8 120 120 120 120-53.8 120-120zm-32 0c0 48.5-39.5 88-88 88s-88-39.5-88-88 39.5-88 88-88 88 39.5 88 88z"></path></svg></a><div class="cta"><button class="dark-switcher" aria-label="Toggle Light/Dark Mode." title="Toggle Light/Dark Mode"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="nav-icons sun-nav-icon" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M277.3 32h-42.7v64h42.7V32zm129.1 43.7L368 114.1l29.9 29.9 38.4-38.4-29.9-29.9zm-300.8 0l-29.9 29.9 38.4 38.4 29.9-29.9-38.4-38.4zM256 128c-70.4 0-128 57.6-128 128s57.6 128 128 128 128-57.6 128-128-57.6-128-128-128zm224 106.7h-64v42.7h64v-42.7zm-384 0H32v42.7h64v-42.7zM397.9 368L368 397.9l38.4 38.4 29.9-29.9-38.4-38.4zm-283.8 0l-38.4 38.4 29.9 29.9 38.4-38.4-29.9-29.9zm163.2 48h-42.7v64h42.7v-64z"></path></svg></button></div></div></div></nav><main id="main-content"><article class="single container"><header class="single-header "><div class="gatsby-image-wrapper"><img src="/static/6653c9ced1b648aa5680b8eebf01fe3f/thumbnail.svg" alt=""/></div><div class="flex"><h1>Redondance &quot;du pauvre&quot; d&#x27;un site personnel</h1><div class="post-meta"><time class="date">18 August, 2022</time>/<!-- --><a class="github-link" href="https://github.com/ramuskay/blog-beerus/edit/master/posts/2022/2022-08-18-redondance-sites/index.md" target="_blank" rel="noopener noreferrer">Edit</a></div><div class="post-meta"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10">null</circle><polyline points="12 6 12 12 16 14">null</polyline></svg>  <!-- -->10<!-- --> min read.<!-- --></div><div class="tag-container"><a style="text-decoration:none" href="/tags/ovh/"><span>ovh</span></a><a style="text-decoration:none" href="/tags/python/"><span>python</span></a></div></div></header><div class="post"><h1 id="contexte" style="position:relative;"><a href="#contexte" aria-label="contexte permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contexte</h1>
<p>Mon serveur hébergé a des petits soucis en ce moment, il a tendance à planter régulièrement malgré le fait que je le supervise activement.<br>
J'ai très longtemps pensé que c'était l'un de mes containers docker qui s'emballait (malgré le fait qu'il y ait des options de runtime de paramétrées) mais il s'avère que c'est le metrics scraper d'OVH installé qui posait problème !<br>
Bref avant de résoudre le problème, mes services hébergés ne répondaient plus de temps en temps et cela reste tout de même très embêtant. Il a donc fallu que je pense à une potentielle redondance !</p>
<h1 id="etude-des-solutions" style="position:relative;"><a href="#etude-des-solutions" aria-label="etude des solutions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Etude des solutions</h1>
<p>Il fallait donc que je trouve une solution pour avoir les sites les plus importants toujours en fonction en cas de défaillance majeure de mon serveur dédié le temps que je trouve une solution à long terme. Pour simplifier la problématique je ne souhaite basculer qu'un seul site pour le moment car il est consulté fréquemment pour des raisons professionnelles, les autres n'ont pas d'importance cruciale.</p>
<p>J'ai les équipements suivants avec moi :</p>
<ul>
<li>Une IP publique dédiée d'OVH</li>
<li>Un serveur hébergé chez OVH</li>
<li>Un micro serveur avec des ressources équivalentes de celle d'OVH chez moi</li>
<li>La fibre et une IP publique dynamique (celle de ma box)</li>
</ul>
<p>Voici les quelques techniques auxquelles j'ai pensé en premier lieu :</p>
<ul>
<li>Backup, Replica</li>
<li>Cluster</li>
<li>Solution de fail over</li>
</ul>
<p>La solution <strong>backup/réplica</strong> a tout de suite été écartée du fait qu'elle ne soit pas du tout flexible. Je fais déjà du backup de mon serveur vers chez moi mais c'est cela concerne plus la conf de mon dockerfile et les datas de certains containers mais rien qui ne me permet de remonter une infra en 10min automatiquement (surtout pour une solution censée rester temporaire).<br>
Pour le <strong>cluster</strong> ça serait la solution idéale, dans mon cas passer sous Docker Swarm ou encore mieux tout migrer sous K8s/K3s. Le problème est que je veux une solution rapide à mettre en place ne necessitant pas une refonte complète de mon infra. D'autant plus que je n'ai pas du tout réfléchi à la conception de ma future infra et comment cela est géré avec une IP publique dynamique.<br>
La dernière proposition est surement la plus adaptée pour moi, trouver une <strong>solution de failover</strong> simple et efficace avec le moins d'intervention humaine sans toucher à la configuration déjà en place.</p>
<p>Une fois choisie il a fallu que je compare les solutions avec les contraintes suivantes :</p>
<ul>
<li>Une bascule faite en 5 minutes max en cas de problème.</li>
<li>L'ensemble des données doivent être identique et synchronisé (si modification d'un fichier html réplication immédiate sur le backup).</li>
<li>Rapide et simple à mettre en place, pas de service payant etc...</li>
</ul>
<p>Après un moment de réflexion voici le workflow imaginé :</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 799px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/0b40409ff0374b8d105c68dfa76bfa3f/dd6e8/schema_failover.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 81.69014084507043%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACdElEQVQ4y21Ua5OiQAzk//+w+3BVt+4pyCpvmAEGUN4goPZVsovluUtVagaS6XQ6E7TLNOPZxsuEeVlQtz38SCFWJTyRIy1q+DJHFOfIzzWm+TOWbD1Hpr2CUWBDYELxNyklHNdlEzLGNC8I4wLzcn2APZu2IpMN44UPnKsWvsjQdANknCASAkIIpCpj/8EJeb9cb2i7ns/S2vUDNAogx2qUhVl2A5wg5VLjrELbT0jzGoHMEac5LNuBHwQIghDmxxFHy0IkJLSm7RAnKZJU8doPI5dD4HXTIFUKoYhxtH2EkWQW5L/e7ggjAV03OIbOs4ZBGPFLXTcQQmK73XEglWqaH3jbvGOnG9jqOu8d12MtbceFsTc5tqobZkyrRjSJJTE6nUumTSzoG7EdxwuGfsDYD5i+GrdqTRURCD20L6saGmUj+zhaXJKUMQMRKFk7jOhtD8POREvvXY+27Rg4TRU2m3e4js9siYQWyhidynE3LZzLCtudDpXlUCrjTqZ5gTwUOB1s3qssY39xOsH1fGZ26mv4YYi6bqGFQiJ0XOReAN/zWaumaXG749H56cvmeeFSyUfaGYaJQEYQVcracslU3qmsUFQ1a0jvlJUSOZ4HahppR7p9TtGVJcrygiUhzZNEcRMphieFMq/Z+R4uVyR+gOLXb1wI6GsKCMzzA9iOw6Ck2fWOxzX7NikPm2fMTYuz6+Ng2Xx5ialu7FGWFeqmRRwnDPg8xz/O8iOAGN/u2O9Nvqek0fvfLXdznS5aX+f5P8DLUyYqI0lS7vrhaOFo2dz1P28b9q2aPhP5DvjClA7RvaMSadSoEbphPP40P/1t/gE/lLzSQjd27wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="schema failover"
        title="schema failover"
        src="/static/0b40409ff0374b8d105c68dfa76bfa3f/dd6e8/schema_failover.png"
        srcset="/static/0b40409ff0374b8d105c68dfa76bfa3f/53f68/schema_failover.png 213w,
/static/0b40409ff0374b8d105c68dfa76bfa3f/df70d/schema_failover.png 425w,
/static/0b40409ff0374b8d105c68dfa76bfa3f/dd6e8/schema_failover.png 799w"
        sizes="(max-width: 799px) 100vw, 799px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Le détail des flux serait donc le suivant :</p>
<ul>
<li>Problème sur la production (serveur OVH) qui rend le site web indisponible</li>
<li>Un script sur le serveur backup vérifie régulièrement la disponibilité du site web</li>
<li>Le script constate l'indisponibilité et via les API OVH change l'IP publique du site en question en la faisant pointer sur le serveur de backup lui-même</li>
<li>Avec un TTL assez faible (60), l'utilisateur devrait avoir accès au site web via le backup</li>
</ul>
<p>Il reste le sujet de la synchronisation des données, solutions possibles :</p>
<ul>
<li>Un montage sur le dossier du site web en question</li>
<li>Un rsync depuis le backup vers la prod à une fréquence régulière</li>
<li>Un rsync depuis la prod vers le backup dès qu'un fichier est modifié</li>
</ul>
<p>J'ai passé pas mal de temps sur ces solutions car elles ont toutes leurs problèmes :</p>
<ul>
<li><strong>Montage</strong> : Aucun intérêt car si la prod plante je n'ai plus de montage et donc plus de donnée, il faut forcément une copie. Je peux toujours par la suite via un cron faire une copie régulière des données en local mais aucun intérêt par rapport aux autres solutions.</li>
<li><strong>Rsync depuis le backup</strong> : Pas trop fan de créer des accès sur mon serveur de prod même si c'est du rsync via clé SSH sur un user non root. Mais surtout comment je détecte qu'un fichier a changé ou été créé ? Seule la prod peut avoir ses infos. J'ai tout de même essayé de créer un montage sshfs avec une surveillance du dossier via l'outil inotify mais cela ne marche pas du tout ensemble, inotify fonctionne avec un système de fichier local.</li>
<li><strong>Rsync depuis la prod</strong> : Dernière solution, celle-ci parait la plus "faisable" la prod surveillant ses fichiers via inotify ou un autre outil et rsync en cas de changement. Par contre avec l'IP dynamique je suis toujours "bloqué" car à chaque redémarrage de ma box je change d'IP. J'ai donc dû faire appel à un service type DynDNS, ma box ne gérant que DynDNS ou NoIP j'ai choisi ce dernier qui a une version freemium (il faut valider manuellement le domaine tous les mois sinon 5€/mois...)</li>
</ul>
<h1 id="mise-en-place" style="position:relative;"><a href="#mise-en-place" aria-label="mise en place permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mise en place</h1>
<p>J'ai 4 parties à mettre en place :</p>
<ul>
<li>Le script de vérification de la disponibilité du site web.</li>
<li>Le script de changement du DNS.</li>
<li>L'outil qui va permettre la synchro des données de la prod vers le backup.</li>
<li>Des petits scripts annexes pour alerter en cas de défaillance de la prod/backup.</li>
</ul>
<p>Toute la partie scripting va être condensée dans un seul et même script</p>
<h2 id="partie-scripting" style="position:relative;"><a href="#partie-scripting" aria-label="partie scripting permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Partie scripting</h2>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">from urllib.request import urlopen, Request
from urllib.error import HTTPError, URLError
import sys
import time
import requests
import dns.resolver
import ovh

new_ip = requests.get('https://api.ipify.org').content.decode('utf8') #Dynamic public IP
domain = "beerus.fr"
site_name = "&lt;the_website_to_monitor>"
ifttt_event = "&lt;event_ifttt_name>" #See https://ifttt.com
ifttt_key = "&lt;event_ifttt_key>" #See https://ifttt.com
ovh_secret = "&lt;ovh_secret>" #See https://docs.ovh.com/ca/fr/api/first-steps-with-ovh-api/
ovh_key = "&lt;ovh_key>" #See https://docs.ovh.com/ca/fr/api/first-steps-with-ovh-api/
ovh_consumer = "&lt;ovh_consumer>" #See https://docs.ovh.com/ca/fr/api/first-steps-with-ovh-api/

# setting the URL you want to monitor
URL = Request("https://{0}.{1}".format(site_name, domain),
              headers={'User-Agent': 'Mozilla/5.0'})
i = 0

#Verify status of the DNS
result = dns.resolver.query(site_name, 'A')
for ipval in result:
    if ipval.to_text() == new_ip:
        print("Already switched")
        sys.exit(0)

#The site is answering ?
while i &lt; 10:
    time.sleep(5)
    print(URL.full_url)
    try:
        response = urlopen(URL, timeout=2)
    except (HTTPError, URLError) as error:
        i = i+1
        continue
    if response.status == 200:
        print("Prod is okay")
        break
    i = i+1

#The website is down so we can switch and alert
if i == 10:
    response = requests.post('https://maker.ifttt.com/trigger/{0}/with/key/{1}'.format(ifttt_event, ifttt_key))
    client = ovh.Client(
        endpoint='ovh-eu',
        application_key=ovh_key,
        application_secret=ovh_secret,
        consumer_key=ovh_consumer,
    )

    result = client.put(
        '/domain/zone/{0}/record/5206233547'.format(domain),
        subDomain=site_name,
        target=new_ip,
        ttl=60,
    )

    result = client.post('/domain/zone/{0}/refresh'.format(domain))</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Le script ci-dessus a été passé en cron sur le serveur backup et est exécuté toutes les 10 minutes.<br>
Il exécute les actions suivantes :</p>
<ul>
<li>Vérification du DNS (le site a-t-il déjà basculé ?)</li>
<li>Curl vers le site en question, 10 tests avec un intervalle de 5s</li>
<li>Si down bascule vers le backup via les API d'OVH</li>
<li>Notification (on verra ça dans une autre partie)</li>
</ul>
<h2 id="synchronisation-donnees" style="position:relative;"><a href="#synchronisation-donnees" aria-label="synchronisation donnees permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Synchronisation données</h2>
<p>Pour la synchro j'avais dans un premier temps pensé à inotify avec rsync.<br>
Il aurait suffi de lancer le binaire (via systemd dans l'idéal) et dès lors qu'il aurait remarqué un event qui match avec les options précisées (create, delete, move etc...) il effectuerait un rsync.<br>
Le problème étant que cela nécessite pas mal de bricolage (script, création d'un systemd etc...) et j'aurais aimé en éviter le plus possible.
Heureusement je suis tombé sur l'outil <strong>lsyncd</strong> qui fait exactement ce travail, pas besoin de réinventer la roue !
En plus il peut se baser sur rsync pour faire ses actions ce qui est parfait pour moi. J'ai fait deux configurations :</p>
<ul>
<li>Une pour le webroot de mon site, en cas de modification/ajout/suppression lsyncd exécute un rsync immédiatement vers mon backup</li>
<li>Une pour le dossier des certificats de mon site web, étant donné que je suis sous LetsEncrypt les certificats sont renouvelés régulièrement. De la même façon dès qu'il y a une modification de ceux-ci (le certificat public à priori) il copie le nouveau certificat sur le backup</li>
</ul>
<p>Tous cela est parfait mais il me manque encore la partie SSH pure car mon serveur backup est hébergé chez moi derrière ma box. J'utilise déjà le port 22 pour d'autres usages donc il va falloir faire de la configuration additionnelle.<br>
J'avais deux possibilités :</p>
<ul>
<li>Je fais un NAT sur un port différent du 22 (du style IP_PUB:2222 --> backup:22)</li>
<li>Je fais un bastion SSH avec un hardenning et qui forward mes requêtes vers mon backup</li>
</ul>
<p>J'ai décidé de faire la deuxième solution, ça permet de s'entrainer sur quelque chose que je n'ai pas l'habitude de faire 🙂. Je passe la partie hardenning car ce n'est pas ce que j'ai envie d'aborder dans ce post mais ça consiste à faire les choses suivantes (non exhaustives) :</p>
<ul>
<li>Fail2ban</li>
<li>No PermitRoot</li>
<li>Authentification par clé uniquement</li>
<li>Un Jail chroot avec un nombre de binaire limité (adios su et sudo 😈)</li>
</ul>
<p>Par rapport au bastion, 3 solutions pour faire ce jump :</p>
<ul>
<li>Stockage des clés SSH sur le bastion</li>
<li>Forwarding SSH agent</li>
<li>Utiliser ProxyCommand/ProxyJump</li>
</ul>
<p><strong>Stockage des clés SSH sur le bastion</strong>: Cela signifie que le bastion possède la clé SSH privée de mon serveur backup, étant donné qu'il reste public cela est toujours dangereux. On met cette idée de côté pour l'instant.<br>
<strong>Forwarding SSH agent</strong>: On passe nos clés privées à un agent SSH puis on forward cet agent sur notre bastion. L'agent SSH étant une socket Unix (lié à la variable $SSH_AUTH_SOCK) le jump host va pointer vers notre agent local au lieu de pointer sur le sien. Mais il suffit d'être root sur le bastion pour faire pointer sa variable $SSH_AUTH_SOCK sur notre socket et accéder au backup. Pas terrible niveau sécu également.<br>
<strong>ProxyCommand/ProxyJump</strong>: La meilleure solution, le serveur intermédiaire (le bastion) exécute une <code class="language-text">ProxyCommand</code> lors de la connexion et forward l'input et l'output vers le backup. Il suffit pour cela d'utiliser l'option <code class="language-text">-J</code> du binaire SSH.<br>
Ex : <code class="language-text">ssh -J username@bastion username@backup</code>. Le seul problème de cette solution c'est que si je veux préciser une clé SSH privée la commande ne peut pas deviner si cela s'applique au bastion ou au backup. Je suis donc passé via la config SSH :</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Host bastion
    User linux
    HostName bastion.domain.tld
    IdentityFile ~/.ssh/bastion_rsa

Host backup #Pas besoin d'être accessible depuis internet donc
    User backup
    HostName backup.domain.lan
    IdentityFile ~/.ssh/backup_rsa
    ProxyJump bastion.domain.tld</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Et lorsque je fais un simple <code class="language-text">ssh backup</code> (après recopie des clés publiques sur les bons serveurs) la magie opère ! Petit test de modification d'un fichier ça fonctionne bien, le fichier modifié est bien propagé sur le backup 🙂</p>
<h2 id="notifications" style="position:relative;"><a href="#notifications" aria-label="notifications permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Notifications</h2>
<p>Dernier point : le fignolage ! Il s'agit désormais de m'avertir en cas de défaillance de la prod OU du backup (on ne sait jamais lui aussi il peut planter !).<br>
Pour le backup je fais presque que la même chose que le script ci-dessus, j'ai des curl qui interroge régulièrement le nom DynDNS pointant vers mon site web (j'ai configuré mon reverse proxy Nginx pour répondre au vrai nom de mon site web et au nom DynDNS). En cas de défaillance je reçois un mail sur ma boite perso @beerus.fr.</p>
<p>Par contre pour la prod c'est plus complexe (et plus important aussi). En fait je pourrais faire le même mécanisme que pour le backup mais je ne recevrai jamais le mail @beerus.fr car mon serveur mail est hébergé sur la même machine que mon site web...<br>
J'ai commencé à regarder pour pouvoir utiliser les API de Gmail mais très honnetement ça ne me tentait pas trop.<br>
Donc à la place j'ai utilisé le service <strong>IFTTT</strong>, j'ai trouvé le concept tellement simple et efficace.
Une application Android (ou Apple) à télécharger ensuite "programmer" son alerte :</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 757px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/7508569b10bf3ac074b7b9ce1309c7e3/70668/ifttt.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 87.79342723004696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACqElEQVQ4y42TWUiUURSAr6aFFdGTBC0Q0UYGEYRBD70E2UPLa09B0Js9hS22Gr30olmmOaMt4+joNGlEikG0gDqbk+aWW4VMkOU4FvWQzsz94t77a5pL/fD95/yHc89/7lnE/T7IboKzfrgUNHKSM76Z+uT3+cAfLgbhWgiutEJRF4gdHljthGMvQRSDKAJxB8RtECXSyGJpYemFGG6AuAkpNnNmfRWIPY8huxk8740xsw4ONsK6Stjultppo0uypVqS8RA2uCRJpZLkUjRJpSBKTQI6YFY9pDtgaw0stsPyclhWDotshhSbJNUOqWVGV9mklUnSyphC+SfbYJsbxNAPCH6F0Ah0jkKHRZdG0j0Goc+/CIR/ar1zVE75dE7jbQT6v4FgwSeh3x+7Q7Q1v5hmk/OeEIPfwTsM7RHoG4Nei3dj0BOVWnaOxGn/Mq71rqi0QNMThe6oyVLFEidew65ayHBbHS62KDF1UQ1QtU2xq5rKqZoplpabGq51wioH7K4DcbkVrreDsx9OeSHXD3mtcLgRshokx1/BzkeSA/WSfU/hyDNJZq1kc42aAtPEybHZVA1ifwOsccLeJ3D0OZxsgkONZnyWlEk9ASqzFXcVsPKemk2p50/csigyM5n+AERFP+T44EIATvsgx2s2IjdgbOf8krw2uPxGZS/1dqituBoyN8mzdLUxelNm90lOk6bLwx96GegIztHl2d0WcQmxxCTSAibikvFYXB8ZCn+ib2BQH1C2iXhilr8invgrQynlDLnQM5+vmM8xEokQCATw+Xy0tLRolO73+wmHw/P+eM4MY7EYlZWVFBQU4HA4tO5yuahwOCgsLMRmsxGNRv+d4fSAVVVV5Ofn64Aejwe3261tKqDdbv+/gLOv7J9xZa/Xq78XuvJvVvnCPbv8G/UAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="ifttt"
        title="ifttt"
        src="/static/7508569b10bf3ac074b7b9ce1309c7e3/70668/ifttt.png"
        srcset="/static/7508569b10bf3ac074b7b9ce1309c7e3/53f68/ifttt.png 213w,
/static/7508569b10bf3ac074b7b9ce1309c7e3/df70d/ifttt.png 425w,
/static/7508569b10bf3ac074b7b9ce1309c7e3/70668/ifttt.png 757w"
        sizes="(max-width: 757px) 100vw, 757px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>Comme on peut le voir ci-dessus en cas de réception d'un webhook on envoie une notification push à l'application IFTTT reliée au compte.<br>
J'ai juste eu à ajouter la commande curl à mon script ci-dessus et le tour était joué, ça marche parfaitement ! Très peu d'infos sont également transmise à ce service tiers (surement une ip publique et peut-être des infos négligables concernant mon téléphone) ça reste acceptable de mon côté, le businness plan consiste à proposer des version premium qui permettent de développer son propre algo ou avoir plus d'event.</p>
<h1 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h1>
<p>Une grosse journée de travail pour concevoir, mettre en place et peaufiner. J'espérais pas mettre plus de temps et c'est chose faite.
J'ai une solution, certes bricolée, mais fonctionnelle et facile. Il me reste tout de même une partie manuelle : en cas de défaillance de la prod et de bascule sur le backup, je dois manuellement refaire pointer le DNS vers la prod (bien que j'utilise un script pour ça).
La solution n'est de toute façon mise en place que temporairement le temps que je réfléchisse à une nouvelle architecture qui sera bien plus robuste et pensée en amont.<br>
Cela reste malgré tout un très bon exercice, très proche du système ça toujours fait du bien de remettre les mains dans le cambouis 🙂</p></div><div class="comment-box-wrapper container pt-7"><h1 class="mb-0">Comments</h1><hr class="my-0"/><div class="comment-box"></div></div></article></main><footer class="footer container"><div><a href="#">Back To Top</a></div><div><a href="/categories">Categories</a><a href="/tags">Tags</a><a href="https://github.com/ramuskay/blog-beerus" target="_blank" rel="noopener noreferrer">Source</a><a href="/rss.xml" target="_blank" rel="noopener noreferrer">RSS</a></div></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" defer="" src="https://u.calvin.me/script.js" data-website-id="90b1fd6b-e6ea-4725-848e-213b6cc123d2" data-auto-track="true" data-do-not-track="false"></script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/redondance-sites";window.___webpackCompilationHash="83f8760eefe07d8d0670";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1f93a574953449163084.js"],"app":["/app-311f5bc98f50788f934e.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-a3eeeaf539efe992685c.js"],"component---src-pages-404-js":["/component---src-pages-404-js-cba9fbe11e6caa2057f5.js"],"component---src-pages-categories-js":["/component---src-pages-categories-js-2bf9e29bc7f7dd9d2524.js"],"component---src-pages-index-js":["/component---src-pages-index-js-7244c3858ec4da3c3655.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-69d191532fe821988318.js"],"component---src-templates-category-js":["/component---src-templates-category-js-38e8087d83d028a0c6e9.js"],"component---src-templates-post-js":["/component---src-templates-post-js-0d74a984f046c51beb01.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-8c063f42fea386445bd9.js"]};/*]]>*/</script><script src="/polyfill-1f93a574953449163084.js" nomodule=""></script><script src="/app-311f5bc98f50788f934e.js" async=""></script><script src="/framework-0a721cd358c50da09b99.js" async=""></script><script src="/webpack-runtime-26faca4ef313ebafb109.js" async=""></script></body></html>